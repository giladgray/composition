(function(){Snap.plugin(function(a,b){return b.prototype.resize=function(a,b){var c,d,e;return c=!1,e=function(a){return function(b){return c=!0,a.data("start",a.getBBox()),a.data("dx",b)}}(this),d=function(d,f,g,h,i){var j;if(i.target===this.paper.node||i.target.parentNode===this.paper.node){if(!i.metaKey)return c=!1;switch(c||e(d,f),j=Math.max(this.data("start").height+d-this.data("dx"),null!=a?a:0),null!=b&&(j=Math.min(b,j)),this.type){case"circle":return this.attr("r",j/2);case"rect":return this.attr({width:j,height:j})}}},this.drag(d,e)}})}).call(this),function(){var a=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};Snap.plugin(function(b,c){var d;return d=function(a,b,c){return Math.min(c,Math.max(b,a))},c.prototype.x=function(){return this.asPX("x")||this.asPX("cx")||0},c.prototype.y=function(){return this.asPX("y")||this.asPX("cy")||0},c.prototype.size=function(){return this.asPX("r")||this.asPX("width")||0},c.prototype.confineDrag=function(b,c){var e,f,g,h;return e=function(a){return function(e,f,g){return null==e&&(e=a.x()),null==f&&(f=a.y()),null==g&&(g=a.size()),a.attr("circle"===a.type?{cx:d(e,g,b-g),cy:d(f,g,c-g)}:{x:d(e,0,b-g),y:d(f,0,c-g)})}}(this),h=function(a,b,c){return this.data("sx",a=c.offsetX-this.x()),this.data("sy",b=c.offsetY-this.y())},g=function(a,b,c,d,f){return f.target===this.paper.node||f.target.parentNode===this.paper.node?f.metaKey||f.altKey?void 0:e(f.offsetX-this.data("sx"),f.offsetY-this.data("sy")):void 0},f=function(b){return a.call(b.target.classList,"trash")>=0&&this.remove(),e()},this.drag(g,h,f)}})}.call(this),function(){Snap.plugin(function(a,b,c,d){var e;return d.selected=null,e=function(a){var b,c,e,f,g;if(d.selected!==a)return null!=(b=d.selected)&&b.attr({opacity:1}),null!=(c=d.selected)&&null!=(e=c.paper)&&e.node.classList.remove("selected"),d.selected=a,null!=(f=d.selected)&&f.attr({opacity:.7}),null!=(g=d.selected)?g.paper.node.classList.add("selected"):void 0},a.focus=function(b){return _.isUndefined(b)?d.selected:(_.isString(b)&&(b=a.select(b)),e(b),b)},b.prototype.focusable=function(){return this.paper.mousedown(function(a){return a.focused?void 0:e()}),this.mousedown(function(a){return a.focused=!0,e(this)})},b.prototype.focus=function(){return a.selected(this)}})}.call(this),function(){Snap.plugin(function(a,b){return b.prototype.rotate=function(){var b,c,d,e,f;return b=!1,c=null,d=null,f=function(a){return function(c,e,f){return b=!0,console.log(a.transform()),a.data("dx",c),a.data("dy",e),d=a.paper.line(f.offsetX,f.offsetY,f.offsetX,f.offsetY),d.attr("stroke","cyan")}}(this),e=function(e,g,h,i,j){var k,l;if(j.target===this.paper.node||j.target.parentNode===this.paper.node)return j.altKey?(b||f(e,g,j),e=this.data("start").x-e,g=this.data("start").y-g,l=a.deg((g-this.data("dy"))/(e-this.data("dx"))),k=new a.Matrix,k.rotate(l,this.asPX("cx")||this.asPX("x")+this.asPX("width")/2,this.asPX("cy")||this.asPX("y")+this.asPX("height")/2),console.log(l,k.toTransformString()),this.transform(k),d.attr("x2",j.offsetX),d.attr("y2",j.offsetY),c=l):(b=!1,d.remove())},this.drag(e)}})}.call(this),function(){var a,b,c,d,e,f,g,h={}.hasOwnProperty,i=function(a,b){function c(){this.constructor=a}for(var d in b)h.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};console.log("'Allo 'Allo!"),f=Snap("#composition"),g=f.node.clientWidth,e=f.node.clientHeight,b=function(){function a(a){if(!a)throw new Error("Must create Element");a.attr({fill:this.color}).resize(5,g).confineDrag(g,e).focusable().rotate()}return a.prototype.color="#fff",a}(),a=function(a){function b(){b.__super__.constructor.call(this,f.circle(g/2,e/2,this.radius))}return i(b,a),b.prototype.radius=25,b}(b),c=function(a){function b(){b.__super__.constructor.call(this,f.rect((g-this.size)/2,(e-this.size)/2,this.size,this.size))}return i(b,a),b.prototype.size=50,b}(b),d=function(a,b){var c;return null!=(c=document.getElementsByClassName(a))?c[0].onclick=b:void 0},d("add circle",function(){return new a}),d("add square",function(){return new c}),d("btn new",function(){return confirm("Your current composition will be lost. Do you want to proceed?")?f.clear():void 0}),d("btn save",function(){return alert("Here is your composition in SVG format. Copy and paste it into a text editor and save it as an .svg file.\n\n"+f.toString())}),d("btn trash",function(){var a;return null!=(a=Snap.focus())&&a.remove(),Snap.focus(null),f.node.classList.remove("selected")})}.call(this);